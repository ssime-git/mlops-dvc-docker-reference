schema: '2.0'
stages:
  ingest:
    cmd: "docker run --rm -v $PROJECT_PATH/data:/data mlops-ingest python ingest.py\n"
    deps:
    - path: stages/ingest/ingest.py
      hash: md5
      md5: 4b379fa80c14b405a0a9f45cc8bd27b4
      size: 984
    outs:
    - path: data/raw/iris.csv
      hash: md5
      md5: 9b81a5b2beab90b5e381dfb33627d536
      size: 4189
  preprocess:
    cmd: "docker run --rm -v $PROJECT_PATH/data:/data mlops-preprocess python preprocess.py\n"
    deps:
    - path: data/raw/iris.csv
      hash: md5
      md5: 9b81a5b2beab90b5e381dfb33627d536
      size: 4189
    - path: stages/preprocess/preprocess.py
      hash: md5
      md5: 4075bd61582344a3241fa8cd4944755b
      size: 1873
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: 12633f6b7b7282fb932761e33b24d21d
      size: 617
    - path: data/processed/train.csv
      hash: md5
      md5: 47fd89ce6c52daa555a94670836c67a2
      size: 2237
  train:
    cmd: "docker run --rm -v $PROJECT_PATH/data:/data -v $PROJECT_PATH/models:/models
      -v $PROJECT_PATH:/workspace:ro -e MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI}
      -e MLFLOW_TRACKING_USERNAME=${MLFLOW_TRACKING_USERNAME} -e MLFLOW_TRACKING_PASSWORD=${MLFLOW_TRACKING_PASSWORD}
      mlops-train python train.py\n"
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 12633f6b7b7282fb932761e33b24d21d
      size: 617
    - path: data/processed/train.csv
      hash: md5
      md5: 47fd89ce6c52daa555a94670836c67a2
      size: 2237
    - path: stages/train/train.py
      hash: md5
      md5: 77faab5ddb87681477094a29d36e6f66
      size: 11033
    params:
      params.yaml:
        train.max_depth: 5
        train.n_estimators: 100
        train.random_state: 42
    outs:
    - path: models/model_metadata.json
      hash: md5
      md5: 3450110bf95d21e647471e79f35d4c85
      size: 326
  evaluate:
    cmd: "docker run --rm -v $PROJECT_PATH/data:/data -v $PROJECT_PATH/models:/models
      -v $PROJECT_PATH/metrics:/metrics -e MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI}
      -e MLFLOW_TRACKING_USERNAME=${MLFLOW_TRACKING_USERNAME} -e MLFLOW_TRACKING_PASSWORD=${MLFLOW_TRACKING_PASSWORD}
      mlops-evaluate python evaluate.py\n"
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 12633f6b7b7282fb932761e33b24d21d
      size: 617
    - path: models/model_metadata.json
      hash: md5
      md5: 3450110bf95d21e647471e79f35d4c85
      size: 326
    - path: stages/evaluate/evaluate.py
      hash: md5
      md5: 4a0a6a3ca25474ba2399b2ae94745f57
      size: 2566
    outs:
    - path: metrics/confusion_matrix.json
      hash: md5
      md5: 54297f8eb6bc045b60c43f35b94ee6d2
      size: 203
    - path: metrics/metrics.json
      hash: md5
      md5: 3424e7d1e3954823a2918290ed086c1a
      size: 137
